<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊäïÊ†á‰∫∫È°∫Â∫èÈöèÊú∫ÊäΩÂèñÁ≥ªÁªü</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a6dba, #0d4d8c);
            color: #fff;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .input-section, .result-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }
        
        .input-section {
            border-right: 1px solid #eaeaea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 15px;
            transition: border .3s;
        }
        
        input:focus, textarea:focus {
            border-color: #1a6dba;
            outline: none;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .file-upload {
            margin-top: 10px;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            text-align: center;
            background: #f9f9f9;
            cursor: pointer;
            transition: all .3s;
        }
        
        .file-upload:hover {
            border-color: #1a6dba;
            background: #f0f7ff;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all .3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .primary-btn {
            background: #1a6dba;
            color: #fff;
        }
        
        .primary-btn:hover {
            background: #0d4d8c;
        }
        
        .secondary-btn {
            background: #f0f0f0;
            color: #333;
        }
        
        .secondary-btn:hover {
            background: #e0e0e0;
        }
        
        .print-btn {
            background: #2b9348;
            color: #fff;
        }
        
        .print-btn:hover {
            background: #23713b;
        }
        
        .result-section {
            display: flex;
            flex-direction: column;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .result-table th, .result-table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #eaeaea;
        }
        
        .result-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #444;
        }
        
        .order-number {
            font-weight: bold;
            color: #1a6dba;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }
        
        .signature-area {
            margin-top: 40px;
            display: none;
        }
        
        .signature-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .signature-item {
            flex: 1;
            text-align: center;
        }
        
        .project-info {
            display: none;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .project-info p {
            font-size: 16px;
            margin: 4px 0;
        }
        
        .status-bar {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-processing {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .status-completed {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .search-box {
            margin-bottom: 15px;
            position: relative;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-box:before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }
        
        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            flex: 1;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a6dba;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .result-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .signature-line {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        @media print {
            body {
                background: none;
                padding: 0;
                font-size: 14px;
            }
            
            header {
                background: none;
                color: #000;
                text-align: center;
                padding: 15px 0;
                margin-bottom: 10px;
            }
            
            .input-section, .buttons, #exportBtn, #printBtn, .search-box, .action-buttons, .status-bar {
                display: none;
            }
            
            .project-info {
                display: block;
                margin-top: 10px;
                border: 1px solid #ddd;
                padding: 10px;
                background: #f8f8f8;
            }
            
            .container {
                box-shadow: none;
                border: none;
                max-width: 100%;
            }
            
            .result-table {
                width: 100%;
                border: 2px solid #000;
                font-size: 14px;
            }
            
            .result-table th, .result-table td {
                border: 1px solid #000;
                padding: 8px 10px;
            }
            
            .result-table th {
                background: #e0e0e0;
            }
            
            .signature-area {
                display: block;
                margin-top: 40px;
            }
            
            .result-section {
                padding: 0;
            }
            
            .order-number {
                color: #000;
            }
            
            .empty-state {
                display: none;
            }
            
            .stats {
                display: flex;
                flex-direction: row;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ÊäïÊ†á‰∫∫È°∫Â∫èÈöèÊú∫ÊäΩÂèñÁ≥ªÁªü</h1>
            <p class="subtitle">Áî®‰∫éÈöèÊú∫ÊäΩÂèñÊäïÊ†á‰∫∫ÊñπÊ°àÊºîÁ§∫„ÄÅÈ°πÁõÆÁªèÁêÜÈôàËø∞ÊàñË∞àÂà§ÁöÑÂÖàÂêéÈ°∫Â∫è</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="form-group">
                    <label for="projectName">È°πÁõÆÂêçÁß∞</label>
                    <input type="text" id="projectName" placeholder="ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞">
                </div>
                
                <div class="form-group">
                    <label for="tenderer">ÊãõÊ†á‰∫∫</label>
                    <input type="text" id="tenderer" placeholder="ËØ∑ËæìÂÖ•ÊãõÊ†á‰∫∫ÂêçÁß∞">
                </div>
                
                <div class="form-group">
                    <label for="agency">ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑ</label>
                    <input type="text" id="agency" placeholder="ËØ∑ËæìÂÖ•ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑÂêçÁß∞">
                </div>
                
                <div class="form-group">
                    <label for="bidderNames">ÊäïÊ†á‰∫∫ÂêçÁß∞ÔºàÊØèË°å‰∏Ä‰∏™Ôºâ</label>
                    <textarea id="bidderNames" placeholder="ËØ∑ËæìÂÖ•ÊäïÊ†á‰∫∫ÂêçÁß∞ÔºåÊØèË°å‰∏Ä‰∏™"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ÂØºÂÖ•ÊäïÊ†á‰∫∫ÂêçÂçïÔºàExcelÊ†ºÂºèÔºâ</label>
                    <div class="file-upload" id="fileUpload">
                        <i>üìä</i>
                        <p>ÁÇπÂáªÊàñÊãñÊãΩExcelÊñá‰ª∂Âà∞Ê≠§Â§Ñ</p>
                        <p id="fileName">Êú™ÈÄâÊã©Êñá‰ª∂</p>
                    </div>
                    <input type="file" id="excelFile" accept=".xlsx, .xls" style="display:none;">
                </div>
                
                <div class="buttons">
                    <button class="primary-btn" id="startDraw">
                        <span>üé≤</span> ÂºÄÂßãÊäΩÂèñ
                    </button>
                    <button class="secondary-btn" id="resetBtn">
                        <span>üîÑ</span> ÈáçÁΩÆ
                    </button>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-header">
                    <h2>ÊäΩÂèñÁªìÊûú</h2>
                    <div class="action-buttons">
                        <button class="primary-btn" id="exportBtn">
                            <span>üì•</span> ÂØºÂá∫ÁªìÊûú
                        </button>
                        <button class="print-btn" id="printBtn">
                            <span>üñ®Ô∏è</span> ÊâìÂç∞ÁªìÊûú
                        </button>
                    </div>
                </div>
                
                <div class="status-bar status-ready" id="statusBar">
                    ÂáÜÂ§áÂ∞±Áª™ÔºåËØ∑Â°´ÂÜôÈ°πÁõÆ‰ø°ÊÅØÂπ∂Ê∑ªÂä†ÊäïÊ†á‰∫∫
                </div>
                
                <div class="stats" id="statsContainer" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-value" id="totalBidders">0</div>
                        <div class="stat-label">ÊäïÊ†á‰∫∫ÊÄªÊï∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="currentOrder">0</div>
                        <div class="stat-label">ÂΩìÂâçÊäΩÂèñÈ°∫Â∫è</div>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢ÊäïÊ†á‰∫∫...">
                </div>
                
                <div class="project-info" id="projectInfo">
                    <p><strong>È°πÁõÆÂêçÁß∞Ôºö</strong><span id="infoProject"></span></p>
                    <p><strong>ÊãõÊ†á‰∫∫Ôºö</strong><span id="infoTenderer"></span></p>
                    <p><strong>ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑÔºö</strong><span id="infoAgency"></span></p>
                    <p><strong>ÊäΩÂèñÊó∂Èó¥Ôºö</strong><span id="infoTime"></span></p>
                </div>
                
                <div class="result-container">
                    <table class="result-table" id="resultTable">
                        <thead>
                            <tr>
                                <th width="15%">È°∫Â∫èÂè∑</th>
                                <th width="70%">ÊäïÊ†á‰∫∫ÂêçÁß∞</th>
                                <th width="15%">Â§áÊ≥®</th>
                            </tr>
                        </thead>
                        <tbody id="resultBody"></tbody>
                    </table>
                    
                    <div class="empty-state" id="emptyState">
                        üìã ÊöÇÊó†ÊäΩÂèñÁªìÊûúÔºåËØ∑Â°´ÂÜôÊäïÊ†á‰∫∫‰ø°ÊÅØÂπ∂ÁÇπÂáª"ÂºÄÂßãÊäΩÂèñ"
                    </div>
                    
                    <div class="signature-area" id="signatureArea">
                        <div class="signature-line">
                            <div class="signature-item">
                                ÊãõÊ†á‰∫∫Á≠æÂ≠óÔºö______________________
                            </div>
                            <div class="signature-item">
                                ÁõëÁù£‰∫∫Á≠æÂ≠óÔºö______________________
                            </div>
                        </div>
                        <div class="signature-line">
                            <div class="signature-item">
                                ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑÁ≠æÂ≠óÔºö______________________
                            </div>
                            <div class="signature-item">
                                ÊäΩÂèñ‰∫∫Á≠æÂ≠óÔºö______________________
                            </div>
                        </div>
                        <div class="signature-line">
                            <div class="signature-item">
                                Êó•ÊúüÔºö______________________
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Ëé∑ÂèñDOMÂÖÉÁ¥†
            const fileUpload = document.getElementById('fileUpload');
            const excelFile = document.getElementById('excelFile');
            const fileName = document.getElementById('fileName');
            const startDrawBtn = document.getElementById('startDraw');
            const resetBtn = document.getElementById('resetBtn');
            const exportBtn = document.getElementById('exportBtn');
            const printBtn = document.getElementById('printBtn');
            const resultBody = document.getElementById('resultBody');
            const emptyState = document.getElementById('emptyState');
            const signatureArea = document.getElementById('signatureArea');
            const projectInfo = document.getElementById('projectInfo');
            const statusBar = document.getElementById('statusBar');
            const searchInput = document.getElementById('searchInput');
            const statsContainer = document.getElementById('statsContainer');
            const totalBidders = document.getElementById('totalBidders');
            const currentOrder = document.getElementById('currentOrder');
            
            // Êï∞ÊçÆÂ≠òÂÇ®
            let bidders = [];
            let results = [];
            
            // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
            initEventListeners();
            
            function initEventListeners() {
                // Êñá‰ª∂‰∏ä‰º†Áõ∏ÂÖ≥‰∫ã‰ª∂
                fileUpload.addEventListener('click', () => excelFile.click());
                excelFile.addEventListener('change', handleFileChange);
                fileUpload.addEventListener('dragover', handleDragOver);
                fileUpload.addEventListener('dragleave', handleDragLeave);
                fileUpload.addEventListener('drop', handleFileDrop);
                
                // ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
                startDrawBtn.addEventListener('click', startDraw);
                resetBtn.addEventListener('click', resetSystem);
                exportBtn.addEventListener('click', exportResults);
                printBtn.addEventListener('click', printResults);
                
                // ÊêúÁ¥¢ÂäüËÉΩ
                searchInput.addEventListener('input', filterResults);
            }
            
            // Êñá‰ª∂Â§ÑÁêÜÂáΩÊï∞
            function handleFileChange(e) {
                if (e.target.files.length > 0) {
                    fileName.textContent = e.target.files[0].name;
                    readExcelFile(e.target.files[0]);
                }
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                fileUpload.style.borderColor = '#1a6dba';
                fileUpload.style.backgroundColor = '#f0f7ff';
            }
            
            function handleDragLeave() {
                fileUpload.style.borderColor = '#ccc';
                fileUpload.style.backgroundColor = '#f9f9f9';
            }
            
            function handleFileDrop(e) {
                e.preventDefault();
                fileUpload.style.borderColor = '#ccc';
                fileUpload.style.backgroundColor = '#f9f9f9';
                
                if (e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        fileName.textContent = file.name;
                        readExcelFile(file);
                    } else {
                        alert('ËØ∑‰∏ä‰º†ExcelÊñá‰ª∂Ôºà.xlsxÊàñ.xlsÊ†ºÂºèÔºâ');
                    }
                }
            }
            
            function readExcelFile(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        // Â∞ùËØïÂ§öÁßçÂèØËÉΩÁöÑÂàóÂêç
                        bidders = jsonData.map(row => {
                            return row['ÊäïÊ†á‰∫∫ÂêçÁß∞'] || row['ÊäïÊ†á‰∫∫'] || row['ÂêçÁß∞'] || 
                                   row['Âçï‰ΩçÂêçÁß∞'] || row['ÂÖ¨Âè∏ÂêçÁß∞'] || Object.values(row)[0];
                        }).filter(name => name && name.trim() !== '');
                        
                        // Êõ¥Êñ∞ÊâãÂä®ËæìÂÖ•ÁöÑÊäïÊ†á‰∫∫
                        document.getElementById('bidderNames').value = bidders.join('\n');
                        
                        // Êõ¥Êñ∞Áä∂ÊÄÅ
                        updateStatus(`Â∑≤ÊàêÂäüÂØºÂÖ• ${bidders.length} ‰∏™ÊäïÊ†á‰∫∫`, 'status-completed');
                    } catch (error) {
                        console.error('ExcelËß£ÊûêÈîôËØØ:', error);
                        alert('ExcelÊñá‰ª∂Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè');
                    }
                };
                
                reader.onerror = function() {
                    alert('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                };
                
                reader.readAsArrayBuffer(file);
            }
            
            // ÊäΩÂèñÂäüËÉΩ
            function startDraw() {
                // Ëé∑ÂèñÊâãÂä®ËæìÂÖ•ÁöÑÊäïÊ†á‰∫∫
                const manualBidders = document.getElementById('bidderNames').value
                    .split('\n')
                    .map(name => name.trim())
                    .filter(name => name !== '');
                
                // ÂêàÂπ∂Êï∞ÊçÆ
                if (manualBidders.length > 0) {
                    bidders = [...new Set([...bidders, ...manualBidders])];
                }
                
                // È™åËØÅÊï∞ÊçÆ
                if (bidders.length === 0) {
                    alert('ËØ∑ÂÖàËæìÂÖ•ÊàñÂØºÂÖ•ÊäïÊ†á‰∫∫‰ø°ÊÅØ');
                    return;
                }
                
                if (bidders.length < 2) {
                    alert('Ëá≥Â∞ëÈúÄË¶Å2‰∏™ÊäïÊ†á‰∫∫ÊâçËÉΩËøõË°åÊäΩÂèñ');
                    return;
                }
                
                // Êõ¥Êñ∞Áä∂ÊÄÅ
                updateStatus(`Ê≠£Âú®ÊäΩÂèñ ${bidders.length} ‰∏™ÊäïÊ†á‰∫∫ÁöÑÈ°∫Â∫è...`, 'status-processing');
                
                // Âª∂ËøüÊòæÁ§∫ÁªìÊûúÔºåÂ¢ûÂä†Áî®Êà∑‰ΩìÈ™å
                setTimeout(() => {
                    // ÈöèÊú∫ÊéíÂ∫è
                    const shuffledBidders = shuffleArray([...bidders]);
                    
                    // Â≠òÂÇ®ÁªìÊûú
                    results = shuffledBidders.map((bidder, index) => ({
                        order: index + 1,
                        name: bidder,
                        remarks: ''
                    }));
                    
                    // ÊòæÁ§∫ÁªìÊûú
                    displayResults(results);
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅ
                    updateStatus(`ÊäΩÂèñÂÆåÊàêÔºåÂÖ± ${results.length} ‰∏™ÊäïÊ†á‰∫∫`, 'status-completed');
                }, 800);
            }
            
            // Fisher-Yates Ê¥óÁâåÁÆóÊ≥ï
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            // ÁªìÊûúÊòæÁ§∫
            function displayResults(resultsToShow) {
                resultBody.innerHTML = '';
                
                if (resultsToShow.length === 0) {
                    emptyState.style.display = 'block';
                    signatureArea.style.display = 'none';
                    statsContainer.style.display = 'none';
                    return;
                }
                
                emptyState.style.display = 'none';
                signatureArea.style.display = 'block';
                statsContainer.style.display = 'flex';
                
                // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
                totalBidders.textContent = resultsToShow.length;
                currentOrder.textContent = resultsToShow.length;
                
                // Êõ¥Êñ∞È°πÁõÆ‰ø°ÊÅØ
                const project = document.getElementById('projectName').value || 'Êú™ÂëΩÂêçÈ°πÁõÆ';
                const tenderer = document.getElementById('tenderer').value || 'Êú™Áü•ÊãõÊ†á‰∫∫';
                const agency = document.getElementById('agency').value || 'Êú™Áü•ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑ';
                const time = new Date().toLocaleString();
                
                document.getElementById('infoProject').textContent = project;
                document.getElementById('infoTenderer').textContent = tenderer;
                document.getElementById('infoAgency').textContent = agency;
                document.getElementById('infoTime').textContent = time;
                projectInfo.style.display = 'block';
                
                // ÁîüÊàêË°®Ê†ºË°å
                resultsToShow.forEach((result, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="order-number">${result.order}</td>
                        <td>${result.name}</td>
                        <td>${result.remarks}</td>
                    `;
                    resultBody.appendChild(row);
                });
            }
            
            // ÊêúÁ¥¢ÂäüËÉΩ
            function filterResults() {
                const searchTerm = searchInput.value.trim().toLowerCase();
                if (searchTerm === '') {
                    displayResults(results);
                } else {
                    const filteredResults = results.filter(result => 
                        result.name.toLowerCase().includes(searchTerm)
                    );
                    displayResults(filteredResults);
                }
            }
            
            // ÈáçÁΩÆÁ≥ªÁªü
            function resetSystem() {
                if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                    document.getElementById('projectName').value = '';
                    document.getElementById('tenderer').value = '';
                    document.getElementById('agency').value = '';
                    document.getElementById('bidderNames').value = '';
                    excelFile.value = '';
                    fileName.textContent = 'Êú™ÈÄâÊã©Êñá‰ª∂';
                    searchInput.value = '';
                    
                    bidders = [];
                    results = [];
                    resultBody.innerHTML = '';
                    emptyState.style.display = 'block';
                    signatureArea.style.display = 'none';
                    projectInfo.style.display = 'none';
                    statsContainer.style.display = 'none';
                    
                    updateStatus('Á≥ªÁªüÂ∑≤ÈáçÁΩÆÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•Êï∞ÊçÆ', 'status-ready');
                }
            }
            
            // ÂØºÂá∫ÁªìÊûú
            function exportResults() {
                if (results.length === 0) {
                    alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÁªìÊûú');
                    return;
                }
                
                const project = document.getElementById('projectName').value || 'Êú™ÂëΩÂêçÈ°πÁõÆ';
                const tenderer = document.getElementById('tenderer').value || 'Êú™Áü•ÊãõÊ†á‰∫∫';
                const agency = document.getElementById('agency').value || 'Êú™Áü•ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑ';
                
                // ÂáÜÂ§áÊï∞ÊçÆ
                const data = [
                    ['È°πÁõÆÂêçÁß∞', project],
                    ['ÊãõÊ†á‰∫∫', tenderer],
                    ['ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑ', agency],
                    ['ÊäΩÂèñÊó∂Èó¥', new Date().toLocaleString()],
                    [],
                    ['È°∫Â∫èÂè∑', 'ÊäïÊ†á‰∫∫ÂêçÁß∞', 'Â§áÊ≥®']
                ];
                
                // Ê∑ªÂä†ÁªìÊûúË°å
                results.forEach(result => {
                    data.push([result.order, result.name, result.remarks]);
                });
                
                data.push([]);
                data.push(['ÊãõÊ†á‰∫∫Á≠æÂ≠óÔºö', '', '']);
                data.push(['ÁõëÁù£‰∫∫Á≠æÂ≠óÔºö', '', '']);
                data.push(['ÊãõÊ†á‰ª£ÁêÜÊú∫ÊûÑÁ≠æÂ≠óÔºö', '', '']);
                data.push(['ÊäΩÂèñ‰∫∫Á≠æÂ≠óÔºö', '', '']);
                data.push(['Êó•ÊúüÔºö', '', '']);
                
                // ÂàõÂª∫Â∑•‰ΩúÁ∞øÂπ∂ÂØºÂá∫
                try {
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ÊäΩÂèñÁªìÊûú');
                    XLSX.writeFile(wb, `${project}_ÊäΩÂèñÁªìÊûú_${new Date().toISOString().slice(0, 10)}.xlsx`);
                    updateStatus('ÁªìÊûúÂ∑≤ÊàêÂäüÂØºÂá∫', 'status-completed');
                } catch (error) {
                    console.error('ÂØºÂá∫ÈîôËØØ:', error);
                    alert('ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                }
            }
            
            // ÊâìÂç∞ÁªìÊûú
            function printResults() {
                if (results.length === 0) {
                    alert('Ê≤°ÊúâÂèØÊâìÂç∞ÁöÑÁªìÊûú');
                    return;
                }
                
                window.print();
            }
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
            function updateStatus(message, statusClass) {
                statusBar.textContent = message;
                statusBar.className = `status-bar ${statusClass}`;
            }
        });
    </script>
</body>
</html>